<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Photo Cropper</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/3.0.0/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
    <style>
        #cropper-container img {
            max-height: 500px;
            display: block;
            margin: 0 auto;
        }

        .cropper-view-box,
        .cropper-face {
            border-radius: 50%; /* Make cropper area circle */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <!-- File Input -->
    <input type="file" id="fileInput" accept="image/*" class="hidden">

    <!-- Profile Image -->
    <div class="w-32 h-32 rounded-full overflow-hidden bg-gray-300">
        <img id="profileImage" src="https://via.placeholder.com/150" alt="Profile Image" class="w-full h-full object-cover">
    </div>

    <!-- Button to Open Modal -->
    <button id="openModalButton" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded">Change Profile Photo</button>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white p-4 rounded-lg shadow-lg w-96">

            <!-- Cropper Container -->
            <div id="cropper-container" class="mb-4">
                <img id="image" src="" alt="Image">
            </div>

            <!-- Buttons -->
            <div class="flex justify-end">
                <button id="cropButton" class="mr-2 px-4 py-2 bg-green-500 text-white rounded">Crop</button>
                <button id="closeModalButton" class="px-4 py-2 bg-red-500 text-white rounded">Cancel</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js"></script>
    <script>
        // Get elements
        const fileInput = document.getElementById('fileInput');
        const openModalButton = document.getElementById('openModalButton');
        const modal = document.getElementById('modal');
        const closeModalButton = document.getElementById('closeModalButton');
        const image = document.getElementById('image');
        const profileImage = document.getElementById('profileImage');
        const cropButton = document.getElementById('cropButton');

        let cropper;

        // Open file input when button is clicked
        openModalButton.addEventListener('click', () => {
            fileInput.click();
        });

        // Show modal with cropper when image is selected
        fileInput.addEventListener('change', (event) => {
            const files = event.target.files;
            if (files && files.length > 0) {
                const reader = new FileReader();
                reader.onload = () => {
                    image.src = reader.result;
                    modal.classList.remove('hidden');
                    if (cropper) {
                        cropper.destroy();
                    }
                    cropper = new Cropper(image, {
                        aspectRatio: 1, // Maintain a square aspect ratio
                        viewMode: 1,
                        ready: function () {
                            // Custom CropperJS Crop Area
                            const cropBoxData = cropper.getCropBoxData();
                            const containerData = cropper.getContainerData();
                            const cropBoxSize = Math.min(containerData.width, containerData.height);
                            
                            cropper.setCropBoxData({
                                left: (containerData.width - cropBoxSize) / 2,
                                top: (containerData.height - cropBoxSize) / 2,
                                width: cropBoxSize,
                                height: cropBoxSize
                            });
                        }
                    });
                };
                reader.readAsDataURL(files[0]);
            }
        });

        // Crop image and update profile image
        cropButton.addEventListener('click', () => {
            const canvas = cropper.getCroppedCanvas({
                width: 200, // Set desired output image dimensions
                height: 200,
                fillColor: '#fff' // Optional: Set background color if needed
            });
            profileImage.src = canvas.toDataURL();
            modal.classList.add('hidden');
        });

        // Close modal
        closeModalButton.addEventListener('click', () => {
            modal.classList.add('hidden');
        });
    </script>
</body>
</html>
